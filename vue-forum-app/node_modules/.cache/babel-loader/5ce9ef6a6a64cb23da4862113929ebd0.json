{"remainingRequest":"/home/scott/forumApp/vue-forum-app/node_modules/babel-loader/lib/index.js!/home/scott/forumApp/vue-forum-app/node_modules/eslint-loader/index.js??ref--13-0!/home/scott/forumApp/vue-forum-app/src/store/modules/users/index.js","dependencies":[{"path":"/home/scott/forumApp/vue-forum-app/src/store/modules/users/index.js","mtime":1596398635585},{"path":"/home/scott/forumApp/vue-forum-app/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/scott/forumApp/vue-forum-app/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/scott/forumApp/vue-forum-app/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _objectSpread from \"/home/scott/forumApp/vue-forum-app/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/home/scott/forumApp/vue-forum-app/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport apiClient from 'api-client';\nimport permissionCheckers from './permissionCheckers';\nexport default {\n  state: {\n    currentUser: null\n  },\n  actions: {\n    registerUser: function () {\n      var _registerUser = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee(_ref, _ref2) {\n        var state, data, user;\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                state = _ref.state;\n                data = _ref2.data;\n                _context.next = 4;\n                return apiClient.registerUser(data);\n\n              case 4:\n                user = _context.sent;\n                return _context.abrupt(\"return\", user);\n\n              case 6:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function registerUser(_x, _x2) {\n        return _registerUser.apply(this, arguments);\n      }\n\n      return registerUser;\n    }(),\n    login: function () {\n      var _login = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee2(_ref3, _ref4) {\n        var commit, email, password, _ref5, token, user;\n\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                commit = _ref3.commit;\n                email = _ref4.email, password = _ref4.password;\n                _context2.next = 4;\n                return apiClient.login({\n                  email: email,\n                  password: password\n                });\n\n              case 4:\n                _ref5 = _context2.sent;\n                token = _ref5.token;\n                user = _ref5.user;\n                localStorage.setItem('auth_token', token);\n                commit('SET_USER_DATA', {\n                  user: user\n                });\n\n              case 9:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      function login(_x3, _x4) {\n        return _login.apply(this, arguments);\n      }\n\n      return login;\n    }(),\n    logout: function logout(_ref6) {\n      var commit = _ref6.commit;\n      localStorage.removeItem('auth_token');\n      commit('SET_USER_DATA', {\n        user: null\n      });\n    },\n    loadCurrentUser: function () {\n      var _loadCurrentUser = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee3(_ref7) {\n        var commit, dispatch, token, user;\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                commit = _ref7.commit, dispatch = _ref7.dispatch;\n                token = localStorage.getItem('auth_token');\n\n                if (!token) {\n                  _context3.next = 13;\n                  break;\n                }\n\n                _context3.prev = 3;\n                _context3.next = 6;\n                return apiClient.getUserData();\n\n              case 6:\n                user = _context3.sent;\n                commit('SET_USER_DATA', {\n                  user: user\n                });\n                _context3.next = 13;\n                break;\n\n              case 10:\n                _context3.prev = 10;\n                _context3.t0 = _context3[\"catch\"](3);\n\n                if (_context3.t0.data.message === 'out-of-date token') {\n                  dispatch('logout');\n                }\n\n              case 13:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, null, [[3, 10]]);\n      }));\n\n      function loadCurrentUser(_x5) {\n        return _loadCurrentUser.apply(this, arguments);\n      }\n\n      return loadCurrentUser;\n    }(),\n    updateCurrentUserProfile: function () {\n      var _updateCurrentUserProfile = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee4(_ref8, _ref9) {\n        var commit, data, _ref10, token, user;\n\n        return regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                commit = _ref8.commit;\n                data = _ref9.data;\n                _context4.next = 4;\n                return apiClient.updateUserProfile({\n                  data: data\n                });\n\n              case 4:\n                _ref10 = _context4.sent;\n                token = _ref10.token;\n                user = _ref10.user;\n                localStorage.setItem('auth_token', token);\n                commit('SET_USER_DATA', {\n                  user: user\n                });\n\n              case 9:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      }));\n\n      function updateCurrentUserProfile(_x6, _x7) {\n        return _updateCurrentUserProfile.apply(this, arguments);\n      }\n\n      return updateCurrentUserProfile;\n    }(),\n    updateCurrentUserPassword: function () {\n      var _updateCurrentUserPassword = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee5(_ref11, _ref12) {\n        var commit, data;\n        return regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                commit = _ref11.commit;\n                data = _ref12.data;\n                _context5.next = 4;\n                return apiClient.updateUserPassword({\n                  data: data\n                });\n\n              case 4:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5);\n      }));\n\n      function updateCurrentUserPassword(_x8, _x9) {\n        return _updateCurrentUserPassword.apply(this, arguments);\n      }\n\n      return updateCurrentUserPassword;\n    }()\n  },\n  mutations: {\n    SET_USER_DATA: function SET_USER_DATA(state, _ref13) {\n      var user = _ref13.user;\n      state.currentUser = _objectSpread({}, user, permissionCheckers);\n    }\n  },\n  getters: {\n    isLoggedIn: function isLoggedIn(state) {\n      var token = localStorage.getItem('auth_token');\n      return state.currentUser !== null && token !== null;\n    }\n  }\n};",{"version":3,"sources":["/home/scott/forumApp/vue-forum-app/src/store/modules/users/index.js"],"names":["apiClient","permissionCheckers","state","currentUser","actions","registerUser","data","user","login","commit","email","password","token","localStorage","setItem","logout","removeItem","loadCurrentUser","dispatch","getItem","getUserData","message","updateCurrentUserProfile","updateUserProfile","updateCurrentUserPassword","updateUserPassword","mutations","SET_USER_DATA","getters","isLoggedIn"],"mappings":"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","sourcesContent":["import apiClient from 'api-client'\nimport permissionCheckers from './permissionCheckers'\n\nexport default {\n  state: {\n    currentUser: null\n  },\n\n  actions: {\n    async registerUser ({ state }, { data }) {\n      const user = await apiClient.registerUser(data)\n      return user\n    },\n\n    async login ({ commit }, { email, password }) {\n      const { token, user } = await apiClient.login({ email, password })\n      localStorage.setItem('auth_token', token)\n      commit('SET_USER_DATA', { user })\n    },\n\n    logout ({ commit }) {\n      localStorage.removeItem('auth_token')\n      commit('SET_USER_DATA', { user: null })\n    },\n\n    async loadCurrentUser ({ commit, dispatch }) {\n      const token = localStorage.getItem('auth_token')\n      if (token) {\n        try {\n          const user = await apiClient.getUserData()\n          commit('SET_USER_DATA', { user })\n        } catch (e) {\n          if (e.data.message === 'out-of-date token') {\n            dispatch('logout')\n          }\n        }\n      }\n    },\n\n    async updateCurrentUserProfile ({ commit }, { data }) {\n      const { token, user } = await apiClient.updateUserProfile({ data })\n      localStorage.setItem('auth_token', token)\n      commit('SET_USER_DATA', { user })\n    },\n\n    async updateCurrentUserPassword ({ commit }, { data }) {\n      await apiClient.updateUserPassword({ data })\n    }\n  },\n\n  mutations: {\n    SET_USER_DATA (state, { user }) {\n      state.currentUser = {\n        ...user,\n        ...permissionCheckers\n      }\n    }\n  },\n\n  getters: {\n    isLoggedIn (state) {\n      const token = localStorage.getItem('auth_token')\n      return (state.currentUser !== null) && (token !== null)\n    }\n  }\n}\n"]}]}